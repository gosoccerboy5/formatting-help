<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="stylesheet.css" />
        <meta charset="UTF-8">
        <title>Change indentation levels</title>
    </head>
    <body>
        <h1>Do you have to deal with formatters that give you an indentation level you don't like?</h1>
        <h2>Well this is the tool for you!</h2>
        <p>Note: doesnt work for tabs</p>
        <p>Just paste your code into the top area, set the amount of spaces you want to get to, and click the button!</p>
        <p>⚠️⚠️ Make sure to run it through <a href="./trim-whitespace">this</a> beforehand if you need to, or else it might not work. ⚠️⚠️</p>
        <textarea id="input"></textarea><br><button id="format">Format with spaces</button><br>
        From<input id="oldspaces" type="number">spaces to<input id="spaces" type="number">spaces 
        <br><textarea id="output"></textarea>
        <br>
        <br>
        <a href="./">Home</a>
        <script>
const input = document.querySelector("#input");
const button = document.querySelector("#format");
const number = document.querySelector("#spaces");
const oldNumber = document.querySelector("#oldspaces");
// Setup

input.oninput = function() {
    const match = this.value.match(/(\n|^) +/g);
    oldNumber.value = match === null ? 2 : match[0].length - (/^ +/.test(this.value.split("\n")[0]) ? 0 : 1);
    //If we cannot guess the amount that each line is indented on with regex, we default to 2.
    // Otherwise, we find the amount that the line is indented on and account for this bug where indentation on the first line
    // is estimated incorrectly.

    number.value = oldNumber.value === "4" ? 2 : 4; // If the value is 4, we assume the user wants to switch to 2 spaces. Otherwise 4.
};

input.oninput(); // Do the above on page load

String.prototype.times = function (amt) {
    let temp = "";
    for (let i = 0; i < amt; i++) {
        temp += this;
    }
    return temp;
    // "Multiply" a string
};

button.addEventListener("click", function (event) {
    (function (target) {
        document.querySelector("#output").value = (
            target.value.replaceAll(/(\n|^) +/g, n => "\n" + " ".times(n.substring(1).length * Number(number.value) / (Number(oldNumber.value))))
        );
    })(input);
    // That was a quite a long line. Basically, the regex matches a pattern of linebreak or string-start, then 1 or more spaces
    // The replacement pattern is a function that return a line-break, and indentation spaces proportionate to how indented the input text was
});

document.querySelector("#output").ondblclick = function () {
    this.select();
};
// Select the output on double click
        </script>
    </body>
</html>
